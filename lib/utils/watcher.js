"use strict";exports.__esModule=true;exports.Watcher=void 0;class Watcher{constructor(condition,limit=500){this.condition=condition;this.state=this.condition();this.limit=limit}async once(handler){const result=await Promise((resolve,reject)=>{let iterations=0;const timeout=()=>setTimeout(()=>{const state=this.condition();if(state!=this.state){resolve(state)}if(iterations>=this.limit){reject(new Error(`Watcher has timed out (limit ${this.limit*10}ms)`))}iterations++;timeout()},10);timeout()});handler(result);return result}async on(handler){const state=await this.once(handler);this.state=state;this.on(handler)}}exports.Watcher=Watcher;